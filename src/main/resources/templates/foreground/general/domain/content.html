<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- 标签页内容 -->
    <title>重庆青少年心理咨询 专注青少年心理健康-【雅秋文化】</title>
    <!-- 网页元信息 -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="IceGlow">
    <meta name="description" content="雅秋文化,与重庆晨报966966共同服务社会,专注青少年心理健康,本站无弹窗无广告,24X7电话:13320337453,QQ咨询：2757861151">
    <meta name="keywords" content="青少年心理健康咨询,婚姻情感咨询,重庆雅秋文化">
    <meta name="author" content="雅秋文化,冰芒科技">
    <!-- css -->
    <link rel="shortcut icon" href="foreground/common/img/favicon.ico">
    <link rel="stylesheet" href="foreground/general/css/font-awesome/font-awesome.min.css">
    <link rel="stylesheet" href="foreground/general/css/highlight/monokai-sublime.min.css">
    <link rel="stylesheet" href="foreground/general/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="foreground/general/css/global/styles.css?=2016121272249">
    <link rel="stylesheet" href="foreground/general/css/animate/animate.min.css">
    <link rel="stylesheet" href="foreground/general/css/mine/global/sign-modal.css">
    <link rel="stylesheet" href="foreground/general/css/mine/global/navibar.css">
    <link rel="stylesheet" href="foreground/general/css/mine/domain/content.css">
    <!-- js -->
    <script src="foreground/general/js/jquery/jquery.min.js"></script>
    <script src="foreground/general/js/bootstrap/bootstrap.min.js"></script>
    <script src="foreground/general/js/vue/vue.js"></script>
    <script src="foreground/general/js/mine/domain/content.js"></script>
</head>

<body>
<!-- 导航栏 -->
<nav class="navbar navbar-default navbar-fixed-top header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-navbar-collapse" aria-expanded="false">
                <span class="sr-only">雅秋文化</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                <img src="foreground/general/img/portal/logo.png">
            </a>
        </div>
        <div class="collapse navbar-collapse" id="header-navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="">
                    <a href="/">首页</a>
                </li>
                <li class="">
                    <a href="/domain?type=case">经典案例</a>
                </li>
                <li class=" bootcamp new-nav logo-1111">
                    <a href="/domain?type=news">实时信息</a>
                </li>
                <li class="">
                    <a href="/domain?type=forum">讨论交流</a>
                </li>
                <li class=" new-nav logo-1111">
                    <a href="/contactUs">联系我们</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- 主要 -->
<div id="content-area" class="container layout layout-margin-top">
    <!-- 主要-路径导航栏 -->
    <ol class="breadcrumb">
        <li><a href="/">首页</a></li>
        <li><a :href="'domain?type=' + content.identifier">{{content.column_name}}</a></li>
        <li class="active">
            <a :href="'content?id=' + content.id">
                {{content.title}}
            </a>
        </li>
    </ol>
    <!-- 主要-内容区域 -->
    <div class="row">
        <!-- 主要-内容区域 -->
        <div class="col-md-12 layout-body">
            <div class="content question-detail">
                <!-- 主要-内容区域-标题 -->
                <div class="question-headline">
                    <span class="question-title">{{content.title}}</span>
                </div>
                <!-- 主要-内容区域-发帖人信息 -->
                <div class="question-author">
                    <div class="user-avatar ">
                        <a class="avatar">
                            <img src="/foreground/general/img/domain/xzy-profile.jpg">
                        </a>
                    </div>
                    <div class="user-username">
                        <a v-if="content.nickname!=null && content.creator_name==null" class="username">
                            {{content.nickname}}
                        </a>
                        <a v-if="content.creator_name!=null && content.nickname==null" class="username">
                            {{content.creator_name}}
                        </a>
                    </div>
                    <span style="margin-left: 2%"> 发布于：{{content.create_time}}</span>
                    <span class="question-from">
                        来自：
                        <a :href="'domain?type=' + content.identifier">{{content.column_name}}</a>
                    </span>
                    <span class="question-figure">{{content.hits_show}} 查看</span>
                    <span id="comment-num" class="question-figure">0 回复</span>
                </div>
                <!-- 主要-内容区域-发帖详情 -->
                <div class="question-content markdown-body">
                    <p v-html="content.main_content"></p>
                </div>
                <!-- 主要-内容区域-回答区域 -->
                <div class="question-answers">
                    <p class="ptilte" style="width: 85%; display: inline-block">评论区</p>
                    <button id="comment-btn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#comment-modal" style="display: inline-block;">发表评论</button>
                    <hr/>
                    <!-- 回答1 -->
                    <div v-for="comment in comments" class="answer-item">
                        <div class="answer-head">
                            <div class="user-avatar">
                                <a class="avatar">
                                    <img :src="'/foreground/common/img/profile-picture/' + comment.profilePictureUrl + '.png'">
                                </a>
                            </div>
                        </div>
                        <div class="answer-detail">
                            <span class="comment-reply">
                                <div class="user-username ">
                                    <a class="username">
                                        {{comment.creatorNickname}}
                                    </a>
                                 </div>
                            </span>
                            <div class="answer-content markdown-body">
                                <p style="font-size: 15px">{{comment.mainContent}}</p>
                            </div>
                            <div>
                                <span class="create-time">{{comment.createTime}}</span>
                                <hr/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 发布评论模态框 -->
<div class="modal fade" id="comment-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:800px; height:500px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">发表评论</h4>
            </div>
            <div class="modal-body">
                <div class="col-md-12">
                    <span>我的评论：</span>
                    <span id="comment-warning" style="display: none; color: red"></span>
                    <textarea id="comment"></textarea>
                </div>
                <br/><br/>
                <div class="col-md-12" style="margin-top: 30px">
                    <span>请输入昵称，以游客身份畅所欲言：</span>
                    <span id="nickname-warning" style="display: none; color: red"></span>
                    <input id="nickname"/>
                </div>
                <br/><br/>
                <div class="col-md-12" style="margin-top: 30px">
                    <span>（选填）您可以填写手机号，方便获取回复提醒：</span>
                    <span id="phone-number-warning" style="display: none; color: red"></span>
                    <input id="phone-number"/>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 200px;">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" onclick="visitorCommentPublish()">发布</button>
            </div>
        </div>
    </div>
</div>

<!-- 尾部 -->
<div class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-4 clearfix footer-col">
                <img src="foreground/general/img/portal/logo.png" style="height: 50px; margin-left: 13%;">
                <div class="footer-slogan">专注青少年心理健康</div>
                <div class="col-xs-2" style="margin-left: 4.1%">
                    <div class="social-item footer-weixin-item" onclick="location.href='/contactUs'">
                        <i class="fa fa-weixin"></i>
                        <div class="footer-weixin">
                            <img src="foreground/common/img/wechat-qr.jpg">
                        </div>
                    </div>
                </div>
                <div class="col-xs-2">
                    <div class="social-item footer-weixin-item" onclick="location.href='/contactUs'">
                        <i class="fa fa-qq"></i>
                        <div class="footer-weixin">
                            <img src="foreground/common/img/qq724029169-qr.jpg">
                        </div>
                    </div>
                </div>
                <div class="col-xs-2">
                    <div class="social-item footer-weixin-item" onclick="location.href='/contactUs'">
                        <i class="fa fa-weibo"></i>
                        <div class="footer-weixin">
                            <img src="foreground/common/img/weibo-qr.png">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-sm-3 col-md-2 footer-col">
                <div class="col-title">关于我们</div>
                <a href="/contactUs" target="_blank">联系我们</a><br>
                <a href="http://710914.023001.com/contact.html" target="_blank">渝政网</a><br>
            </div>
            <div class="col-xs-6 col-sm-3 col-md-2 footer-col">
                <div class="col-title">社交平台</div>
                <a href="/contactUs" target="_blank">微信公众号</a><br>
                <a href="https://tieba.baidu.com/home/main?un=%D1%C5%C7%EF%D0%C4%C0%ED%BD%A1%BF%B5&red_tag=2909657219" target="_blank">百度贴吧</a><br>
                <a href="/contactUs" target="_blank">QQ</a><br>
                <a href="/contactUs" target="_blank">微信</a><br>
                <a href="https://weibo.com/u/3530063191?source=blog&is_all=1" target="_blank">微博</a><br>
                <a href="http://blog.sina.com.cn/u/3530063191" target="_blank">新浪博客</a>
            </div>
            <div class="col-xs-6 col-sm-3 col-md-2 footer-col">
                <div class="col-title">内容专题</div>
                <a href="/domain?type=case" target="_blank">心理问题</a><br>
                <a href="/domain?type=case" target="_blank">精神问题</a><br>
                <a href="/domain?type=case" target="_blank">心理问题</a><br>
                <a href="/domain?type=case" target="_blank">托管补习</a><br>
            </div>
            <div class="col-xs-6 col-sm-3 col-md-2 footer-col">
                <div class="col-title">内容板块</div>
                <a href="/domain?type=case" target="_blank">经典案例</a><br>
                <a href="/domain?type=news" target="_blank">实时信息</a><br>
                <a href="/domain?type=forum" target="_blank">讨论交流</a><br>
                <a href="/contactUs" target="_blank">联系我们</a><br>
            </div>
        </div>
    </div>
    <div class="text-center copyright">
        <span>Copyright @2017-2020 重庆雅秋文化传播有限公司</span>
        <span class="ver-line"> | </span>
        <a class="text-white" href="http://www.beian.miit.gov.cn" target="_blank">渝ICP备19009262号-2</a>
    </div>
</div>
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else{
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
</body>
<!-- 文档就绪-外联js -->
<script src="foreground/general/js/mine/global/login-btn.js"></script>
<script th:inline="javascript">
    /**
     *@Description 全局变量
     *@author CiaoLee
     */
    let contentId = [[${contentId}]];

    /**
     *@Description Vue全局变量
     *@author CiaoLee
     */
    let contentVue = new Vue({
        el: "#content-area",
        data: {
            content: {},
            comments: []
        },
        beforeCreate() {
            getSpecifiedContent();
        },
        mounted() {
            contentHitsUp();
            getSpecifiedComments();
        }
    });

    /**
     *@Description 绑定事件
     *@author CiaoLee
     */
    /* “发布评论”模态框按钮 */
    $("#comment-btn").click(function() {
        $("#nickname").val("");
        $("#comment").val("");
        $("#phone-number").val("");
        $("#nickname-warning").hide();
        $("#comment-warning").hide();
        $("#phone-number-warning").hide();
        $("#comment-modal").addClass("in");
    });
    /* 昵称输入框 */
    $("#nickname").focus(function() {
        $("#nickname-warning").hide();
    });
    /* 评论输入框 */
    $("#comment").focus(function() {
        $("#comment-warning").hide();
    });
    /* 手机号输入框 */
    $("#phone-number").focus(function() {
        $("#phone-number-warning").hide();
    });

    /**
     *@Description 查询当前文章详情
     *@param contentId
     *@author CiaoLee
     */
    function getSpecifiedContent() {
        $.ajax({
            url: "/content/getSpecifiedContent",
            type: "get",
            data: {"id": contentId},
            success: function (rtnData) {
                contentVue.content = rtnData.data;
            }
        });
    }

    /**
     *@Description 文章点击量增加
     *@private contentId 文章主键（全局变量）
     *@author CiaoLee
     */
    function contentHitsUp() {
        $.ajax({
            url: "/content/contentHitsUp",
            type: "post",
            data: {"contentId": contentId}
        });
    }

    /**
     *@Description 游客发布评论
     *@private contentId 文章主键（全局变量）
     *@author CiaoLee
     */
    function visitorCommentPublish() {
        /* 获取参数 */
        let nickname = $("#nickname").val();
        let comment = $("#comment").val();
        let phoneNumber = $("#phone-number").val();
        /* 获取警告框 */
        let nicknameWarning = $("#nickname-warning");
        let commentWarning = $("#comment-warning");
        let phoneNumberWarning = $("#phone-number-warning");
        /* 参数验证 */
        let flag = 1;
        if(nickname === "") {
            nicknameWarning.html("请输入昵称");
            nicknameWarning.show();
            flag = 0;
        }
        if(comment === "") {
            commentWarning.html("请输入评论");
            commentWarning.show();
            flag = 0;
        }
        if(nickname.length > 20) {
            nicknameWarning.html("昵称长度请保持在20字以内");
            nicknameWarning.show();
            flag = 0;
        }
        if(comment.length > 80) {
            commentWarning.html("评论字数请控制在80字以内");
            commentWarning.show();
            flag = 0;
        }
        if(phoneNumber!=="" && !(/^1[3456789]\d{9}$/.test(phoneNumber))) {
            phoneNumberWarning.html("请输入正确手机号，或者不填写手机号");
            phoneNumberWarning.show();
            flag = 0;
        }
        if(flag === 0) return;
        $.ajax({
            url: "/comment/visitorCommentPublish",
            type: "post",
            data: {"contentId": contentId, "creatorNickname":nickname, "mainContent":comment, "phoneNumber": phoneNumber},
            success: function(rtnData) {
                if(rtnData.code === "success") {
                    alert("发布成功！");
                    $('#comment-modal').modal('hide');
                }
                if(rtnData.code === "error") {
                    alert("发布失败，请重试");
                }
            }
        });
    }

    /**
     *@Description 获取文章的评论
     *@private contentId 文章主键（全局变量）
     *@author CiaoLee
     */
    function getSpecifiedComments() {
        $.ajax({
            url: "/comment/getSpecifiedComments",
            type: "get",
            data: {"contentId": contentId},
            success: function(rtnData) {
                if(rtnData.code === "success") {
                    contentVue.comments = rtnData.data;
                    $("#comment-num").html(rtnData.data==null?0:rtnData.data.length + " 回复");
                }
                if(rtnData.code === "error") {
                    $(".ptilte").html("评论区加载失败，请刷新页面");
                }
            }
        });
    }
</script>
</html>
